#/etc/init/<%= fetch(:application) %>_<%= fetch(:rails_env) %>.conf
description "<%= fetch(:application) %>_<%= fetch(:rails_env) %>"
author "Alexander Merkulov <sasha@merqlove.ru>"

start on runlevel [2345]
stop on runlevel [06]
#stop on runlevel [!2345]
#start on virtual-filesystems

script
exec su -s /bin/sh merkulov
export RAILS_ENV=<%= fetch(:rails_env) %>
export APP_PATH=<%= current_path %>
export SHARED_PATH=<%= shared_path %>
export TEMP_PATH="$SHARED_PATH/tmp"
RBENV_ROOT=<%= default_environment['RBENV_ROOT'] %>
export PATH=<%= default_environment['PATH'] %>
cd $APP_PATH && bin/puma.sh -c config/puma/production.rb
end script

post-stop exec su -s /bin/sh -c kill -QUIT `cat <%= shared_path %>/pids/unicorn.pid` merkulov